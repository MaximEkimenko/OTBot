---
title: OTBot README
created: 30.05.2025
modified: 09.06.2025
---
# Предназначение бота
- Бот предназначен для автоматизации процессов создания и учёта предписаний, хранения информации и  создания статистических отчётов для отдела охраны труда. Подробная инструкция пользователя доступна в папке `/bot/docs`.

# Установка 
- Клонировать проект:
```bash
git clone <project link>
```

- Скопировать на сервер (заполнить самостоятельно ) `.env` файл с переменными окружения, например:
```text
DB_NAME=otbot.db
BOT_TOKEN=1241555657:AFASWz0lUfUrllP89gTPuorzH-JhBiylKmU
```

- Установить uv на сервер.
```bash
pip install uv
```

- Установить виртуальное окружение с зависимостями:
```bash
uv sync
```

- Если нужно запускать на тестовой машине, то в окружение необходимо:
    - Установить [typst](https://typst.app/), который используется для генерации pdf отчетов:
```bash
# windows
winget install --id Typst.Typst # возможно потребуется добавление typst в PATH

# linux
# Скачать последнюю версию (замените X.X.X на актуальную версию)
wget https://github.com/typst/typst/releases/download/v0.13.1/typst-x86_64-unknown-linux-musl.tar.xz

# Распаковать
tar -xvf typst-x86_64-unknown-linux-musl.tar.xz

# перейти в распакованеную папке typst-x86_64-unknown-linux-musl
cd typst-x86_64-unknown-linux-musl

# Переместить в /usr/local/bin (требует sudo)
sudo mv typst /usr/local/bin/

# Проверить установку
typst --version
# папке typst-x86_64-unknown-linux-musl можно удалить
```

- установить миграции:
```
alembic revision --autogenerate
alembic upgrade head
```

- далее можно запускать напрямую на сервере:
```bash
python3 main.py
```

## Запуск в `docker`
- выполняется только после всех предыдущих пунктов;
- сборка образа:
```bash
docker build -t otbot .
```
- запуск контейнера
```bash
docker run -d -v "$(pwd)/otbot.db:/app/otbot.db" -v "$(pwd)/logs:/app/logs" -v "$(pwd)/typst:/app/typst" -v "$(pwd)/violations:/app/violations" --name otbot-ins otbot
```
- команды управления 
```bash
docker ps -a  # все контейнеры
docker logs otbot-ins  # посмотреть логи (флаг -f делает просмотр постоянным)
docker stop otbot-ins # остановить контейнер
docker rm otbot-ins # удалить контейнер
docker start otbot-ins  # запустить контейнер
```

## Окончательная настройка
- После запуска бота:
    - Пользователи могут провести настройку клавиатур для категорий нарушений (оприсано в инструкции пользователя).
    - Пользователи могут выполнить настройку отчётов (описано в инструкции пользователя).
    - Зарегистрируйте пользователей и назначьте роли ответственных (смотри инструкцию по использованию).
    - Создайте места нарушения с помощью команд бота (смотри инструкцию по использованию).
- получить инструкцию пользователя можно командой бота:  `/instruction` или найти ссылку в команде `/help` или в папке проекта`/bot/docs`

## Примечания 
- Одобрять пользователей могут только супер пользователи (администраторы бота).  Поменять или добавить список супер пользователей можно в файле `constants.py` (переменная: `SUPER_USERS_TG_ID`).
- `telegram_id` целевой группы для рассылки сообщений находится в переменной `TG_GROUP_ID` `constants.py`.

[[OTBot]]
